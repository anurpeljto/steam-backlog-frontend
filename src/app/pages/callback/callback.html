<section class="main-container">
    <div class="profile-box">
        <app-profile-box></app-profile-box>
    </div>
    <!--  -->
    <div class="top">
        <div class="top-content">
            <p class="title">Your games</p>
            <mat-form-field>
                    <mat-label>Search</mat-label>
                    <input matInput placeholder="Ex. The Witcher 3" [value]="search" (input)="onSearchChange($event)">
                </mat-form-field>
            <div class="tags-container">
                @for (genre of genres; track $index) {
                    <div class="tag" (click)="queryByGenre(genre.genre)">
                        {{genre.genre}}
                    </div>
                }
                <div class="tags-container">
                    <div class="tag" style="background-color: hsl(0, 99%, 59%) !important; color: black !important" (click)="queryByFilter(0)">
                        Never played
                    </div>
                    <div class="tag" style="background-color: hsl(36, 100%, 57%) !important; color: black !important" (click)="queryByFilter(180)">
                        Less than 3 hours played
                    </div>
                </div>
            </div>
        </div>
        @if (dataLoaded) {
            <div class="games-container">
                @for (game of games; track $index) {
                    @if(game.isplayingcurrently){
                        <app-gamecard [playing]="true" [action]="queryByGenre.bind(this)" [category]="queryByCategory.bind(this)" [game]="game" (changeEmitter)="loadGameDataFromDb(this.page, this.size)"></app-gamecard>
                    }
                    @else {
                        <app-gamecard [action]="queryByGenre.bind(this)" [category]="queryByCategory.bind(this)" [game]="game" (changeEmitter)="loadGameDataFromDb(this.page, this.size)"></app-gamecard>
                    }
                }
                    <mat-paginator [length]="total" [pageSize]="50" (page)="onChangePage($event)" [pageSizeOptions]="[25,50,100]"></mat-paginator>
            </div>
        }
    </div>
@if(!dataLoaded) {
        <div class="spinner">
            <mat-progress-spinner mode="indeterminate" color="accent" diameter="250"></mat-progress-spinner>
            <h1>Please bare with us while we fetch your game metadata :)</h1>
        </div>
    }

@if(promptVisible){
    <div class="overlay">
        <div class="content">
            <div class="header">
                <button mat-icon-button (click)="close()">
                    <fa-icon [icon]="faClose"></fa-icon>
                </button>
                <div style="display: flex; flex-direction: column; gap: 1em">
                    <h2>Are you still playing <i>{{this.streak.game_title}}?</i></h2>
                    <span>This is necessary to keep track of your streak. If you select <strong>'No'</strong>, your score will reset. If you select <strong>'Finished'</strong>, you will have 72 hours to select a new game to play without losing your streak.</span>
                </div>
                <div id="invisible"></div>
            </div>

            <div class="options">
            <button class="option yes" (click)="processStreakUpdate(ResponseTypes.Yes)">Yes</button>
            <button class="option no" (click)="processStreakUpdate(ResponseTypes.No)">No</button>
            <button class="option finished" (click)="processStreakUpdate(ResponseTypes.Finished)">Finished</button>
            </div>
        </div>
    </div>
}
</section>